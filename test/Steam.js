
var expect = require('chai').expect;
var request = require('request');

describe('Steam Modeler Unit Test', function()
{	
    it('Steam Modeler Unit Test 1', function(done) {
        request('https://localhost:8080/steam/SteamAssessment?baselinePowerDemand=1&isBaselineCalc=true&operationsInput={"sitePowerImport":18000000,"makeUpWaterTemperature":283.15,"operatingHoursPerYear":8000,"fuelCosts":0.000005478,"electricityCosts":1.39E-05,"makeUpWaterCosts":0.66}&boilerInput={"fuelType":1,"fuel":1,"combustionEfficiency":85,"blowdownRate":2,"blowdownFlashed":true,"preheatMakeupWater":true,"steamTemperature":514.2,"deaeratorVentRate":0.1,"deaeratorPressure":0.204747,"approachTemperature":10}&headerInput={"highPressureHeader":{"pressure":1.136,"processSteamUsage":22680,"condensationRecoveryRate":50,"heatLoss":0.1,"condensateReturnTemperature":338.7,"flashCondensateReturn":true}}&turbineInput={"highToLowTurbine":{"isentropicEfficiency":2,"generationEfficiency":2,"condenserPressure":2,"operationType":2,"operationValue1":2,"operationValue2":2,"useTurbine":true},"highToMediumTurbine":{"isentropicEfficiency":3,"generationEfficiency":3,"condenserPressure":3,"operationType":3,"operationValue1":3,"operationValue2":3,"useTurbine":true},"mediumToLowTurbine":{"isentropicEfficiency":4,"generationEfficiency":4,"condenserPressure":4,"operationType":4,"operationValue1":4,"operationValue2":4,"useTurbine":true},"condensingTurbine":{"isentropicEfficiency":1,"generationEfficiency":1,"condenserPressure":1,"operationType":1,"operationValue":1,"useTurbine":true}}', function(error, response, body){        
        var value = JSON.parse(body)[0];
        //console.log(value);
        //value = value.results;
        expect(value.operationsOutput).to.include(JSON.parse('{"powerGenerated":1,"boilerFuelCost":3270792.6312980186,"makeupWaterCost":62865.242016338656,"totalOperatingCost":5335257.873314357,"powerGenerationCost":2001600.0000000002,"boilerFuelUsage":597077880850.3137,"sitePowerImport":18000000,"sitePowerDemand":18000001,"makeupWaterVolumeFlow":11.906295836427775,"makeupWaterVolumeFlowAnnual":95250.3666914222}'));
        expect(value.boilerOutput).to.include(JSON.parse('{"steamPressure":1.136,"steamTemperature":514.2,"steamSpecificEnthalpy":2917.838793476974,"steamSpecificEntropy":6.8211883441380285,"steamQuality":1,"steamVolume":0.19960611293064956,"steamMassFlow":26261.30665156052,"steamEnergyFlow":76626259.31531818,"blowdownPressure":1.136,"blowdownTemperature":458.65273574845287,"blowdownSpecificEnthalpy":787.5557825431341,"blowdownSpecificEntropy":2.1926588668498703,"blowdownQuality":0,"blowdownVolume":0.001135002372530348,"blowdownMassFlow":535.9450337053167,"blowdownEnergyFlow":422086.61041989713,"feedwaterPressure":0.204747,"feedwaterTemperature":394.1047658380901,"feedwaterSpecificEnthalpy":507.8439104587324,"feedwaterSpecificEntropy":1.5381113180769446,"feedwaterQuality":0,"feedwaterVolume":0.0010611946777477246,"feedwaterMassFlow":26797.251685265837,"feedwaterEnergyFlow":13608821.08539226,"boilerEnergy":63439524.84034582,"fuelEnergy":74634735.10628921,"blowdownRate":2,"combustionEff":85}'));
        expect(value.deaeratorOutput).to.include(JSON.parse('{"feedwaterPressure":0.204747,"feedwaterTemperature":394.1047658380901,"feedwaterSpecificEnthalpy":507.8439104587324,"feedwaterSpecificEntropy":1.5381113180769446,"feedwaterQuality":0,"feedwaterVolume":0.0010611946777477246,"feedwaterMassFlow":26797.251685265837,"feedwaterEnergyFlow":13608821.08539226,"inletSteamPressure":1.136,"inletSteamTemperature":512.9220160918137,"inletSteamSpecificEnthalpy":2914.920954683495,"inletSteamSpecificEntropy":6.815506757222659,"inletSteamQuality":1,"inletSteamVolume":0.199008042924959,"inletSteamMassFlow":3229.2871824288577,"inletSteamEnergyFlow":9413116.876752699,"inletWaterPressure":0.204747,"inletWaterTemperature":316.30494350601714,"inletWaterSpecificEnthalpy":180.89832510382604,"inletWaterSpecificEntropy":0.6142383405729448,"inletWaterQuality":0,"inletWaterVolume":0.0010090535069731171,"inletWaterMassFlow":23594.761754522246,"inletWaterEnergyFlow":4268252.882616886,"ventedSteamPressure":0.204747,"ventedSteamTemperature":394.1047658380901,"ventedSteamSpecificEnthalpy":2707.3177066592766,"ventedSteamSpecificEntropy":7.11902821487601,"ventedSteamQuality":1,"ventedSteamVolume":0.8664961907839751,"ventedSteamMassFlow":26.797251685265838,"ventedSteamEnergyFlow":72548.67397732535}'));
        expect(value.highPressureSteamHeatLoss).to.include(JSON.parse('{"heatLoss":76626.25931531191,"inletPressure":1.136,"inletTemperature":514.1999999999996,"inletSpecificEnthalpy":2917.8387934769735,"inletSpecificEntropy":6.821188344138027,"inletQuality":1,"inletVolume":0.1996061129306493,"inletMassFlow":26261.30665156052,"inletEnergyFlow":76626259.31531817,"outletPressure":1.136,"outletTemperature":512.922016091814,"outletSpecificEnthalpy":2914.9209546834954,"outletSpecificEntropy":6.81550675722266,"outletQuality":1,"outletVolume":0.19900804292495916,"outletMassFlow":26261.30665156052,"outletEnergyFlow":76549633.05600286}'));
        done();
        });
    });
}); 